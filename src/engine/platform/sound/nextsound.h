#ifndef NEXTSOUND_H
#define NEXTSOUND_H

#ifdef __cplusplus
extern "C" {
#endif

struct NEXTChannel {
	unsigned short freq;
	unsigned char vol;
	int noise;
	
	int counter;
	int output;
	int real_output;

  int lfsr_state;
  int lfsr_mode3_sign;
  int lfsr_divider;
  int lfsr_counter;

  int carrier;
  int modulator;
  int old_carrier;
  int old_modulator;
};

struct NEXTChip {
	unsigned short buffer;
	struct NEXTChannel chan[4];
};

static const double NEXT_dac_table[] = {
	0.000000, 0.000409, 0.000832, 0.001271, 0.001725, 0.002196, 0.002684, 0.003189,
	0.003713, 0.004255, 0.004817, 0.005399, 0.006002, 0.006627, 0.007274, 0.007945,
	0.008639, 0.009359, 0.010104, 0.010877, 0.011677, 0.012505, 0.013364, 0.014254,
	0.015175, 0.016130, 0.017119, 0.018144, 0.019205, 0.020305, 0.021444, 0.022624,
	0.023847, 0.025114, 0.026426, 0.027786, 0.029194, 0.030653, 0.032165, 0.033731,
	0.035353, 0.037034, 0.038775, 0.040579, 0.042447, 0.044383, 0.046389, 0.048466,
	0.050619, 0.052849, 0.055159, 0.057552, 0.060031, 0.062600, 0.065260, 0.068017,
	0.070873, 0.073831, 0.076896, 0.080072, 0.083361, 0.086769, 0.090299, 0.093957,
	0.097746, 0.101671, 0.105738, 0.109951, 0.114315, 0.118837, 0.123521, 0.128373,
	0.133401, 0.138609, 0.144004, 0.149594, 0.155384, 0.161383, 0.167598, 0.174037,
	0.180707, 0.187617, 0.194775, 0.202191, 0.209874, 0.217834, 0.226079, 0.234622,
	0.243471, 0.252640, 0.262137, 0.271977, 0.282171, 0.292731, 0.303671, 0.315005,
	0.326747, 0.338911, 0.351513, 0.364568, 0.378092, 0.392104, 0.406619, 0.421657,
	0.437235, 0.453374, 0.470094, 0.487415, 0.505360, 0.523949, 0.543208, 0.563160,
	0.583829, 0.605242, 0.627426, 0.650407, 0.674215, 0.698880, 0.724433, 0.750904,
	0.778328, 0.806738, 0.836171, 0.866662, 0.898251, 0.930976, 0.964878, 1.000000,
};

void next_writereg(struct NEXTChip* chip, unsigned char addr, unsigned char val);
void next_render(struct NEXTChip* chip);
void next_reset(struct NEXTChip* chip);

#ifdef __cplusplus
};
#endif
#endif
